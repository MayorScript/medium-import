<!DOCTYPE html>
<html>

<head>
    <meta property="article:published_time" content="2022-01-01T12:00:00.000Z" />
</head>

<body>
    <main>
        <article>
            <img
  fetchpriority="high"
  decoding="async"
  width="895"
  height="597"
  src="https://blog.logrocket.com/wp-content/uploads/2022/05/CRUD-REST-API-Node-js-Express-PostgreSQL.png"
  class="attachment-full size-full wp-post-image"
  alt="Crud Rest Api With Node Js Express And Postgresql"
  srcset="
    https://blog.logrocket.com/wp-content/uploads/2022/05/CRUD-REST-API-Node-js-Express-PostgreSQL.png                895w,
    https://blog.logrocket.com/wp-content/uploads/2022/05/CRUD-REST-API-Node-js-Express-PostgreSQL.png?resize=300,200 300w,
    https://blog.logrocket.com/wp-content/uploads/2022/05/CRUD-REST-API-Node-js-Express-PostgreSQL.png?resize=768,512 768w
  "
  sizes="(max-width: 895px) 100vw, 895px"
  data-attachment-id="185856"
  data-permalink="https://blog.logrocket.com/crud-rest-api-node-js-express-postgresql/attachment/crud-rest-api-node-js-express-postgresql-2/"
  data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/05/CRUD-REST-API-Node-js-Express-PostgreSQL.png"
  data-orig-size="895,597"
  data-comments-opened="1"
  data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}'
  data-image-title="CRUD-REST-API-Node-js-Express-PostgreSQL"
  data-image-description
  data-image-caption
  data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/05/CRUD-REST-API-Node-js-Express-PostgreSQL.png?w=300"
  data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/05/CRUD-REST-API-Node-js-Express-PostgreSQL.png?w=895"
/>
<p>
  Working with APIs to facilitate communication between software systems is
  crucial for modern web developers. In this tutorial, we’ll create a CRUD
  RESTful API in a Node.js environment that runs on an Express server and uses a
  PostgreSQL database.
</p>
<p>
  We’ll also walk through connecting an Express server with PostgreSQL using
  <a href="https://node-postgres.com/">node-postgres</a>. Our API will be able
  to handle the HTTP request methods that correspond to the PostgreSQL database
  from which the API gets its data. You’ll also learn how to install PostgreSQL
  and work with it through the CLI.
</p>
<p>
  Our goal is to allow CRUD operations — <code>GET</code>, <code>POST</code>,
  <code>PUT</code>, and <code>DELETE</code> — on the API, which will run the
  corresponding database commands. To do so, we’ll set up a route for each
  endpoint and a function for each query.
</p>
<p>To follow along with this tutorial, you‘ll need:</p>
<ul>
  <li>Familiarity with the JavaScript syntax and fundamentals</li>
  <li>Basic knowledge of working with the command line</li>
  <li>Node.js and npm installed</li>
</ul>
<p>
  The complete code for the tutorial is available in this
  <a href="https://github.com/nemo0/node-postgres-crud-api">GitHub repo</a>.
  Let’s get started!
</p>
<h2 id="what-is-restful-api">What is a RESTful API?</h2>
<p>
  Representational State Transfer (REST) defines a set of standards for web
  services.
</p>
<p>
  An API is an interface that software programs use to communicate with each
  other. Therefore, a RESTful API is an API that conforms to the REST
  architectural style and constraints.
</p>
<p>
  REST systems are stateless, scalable, cacheable, and have a uniform interface.
</p>
<h2 id="what-is-crud-api">What is a CRUD API?</h2>
<p>
  When building an API, you want your model to provide four basic
  functionalities. It should be able to create, read, update, and delete
  resources. This set of essential operations is commonly referred to as CRUD.
</p>
<p>
  RESTful APIs most commonly utilize HTTP requests. Four of the most common HTTP
  methods in a REST environment are <code>GET</code>, <code>POST</code>,
  <code>PUT</code>, and <code>DELETE</code>, which are the methods by which a
  developer can create a CRUD system:
</p>
<ul>
  <li>
    <code>Create</code>: Use the <code>HTTP POST</code> method to create a
    resource in a REST environment
  </li>
  <li>
    <code>Read</code>: Use the <code>GET</code> method to read a resource,
    retrieving data without altering it
  </li>
  <li>
    <code>Update</code>: Use the <code>PUT</code> method to update a resource
  </li>
  <li>
    <code>Delete</code>: Use the <code>DELETE</code> method to remove a resource
    from the system
  </li>
</ul>
<h2 id="what-is-express">What is Express?</h2>
<p>
  According to the official
  <a href="https://expressjs.com/">Express documentation</a>, Express is a fast,
  unopinionated, minimalist web framework for Node.js. Express is one of the
  most popular frameworks for Node.js. In fact, each E in the MERN, MEVN, and
  MEAN stacks stands for Express.
</p>
<p>
  Although Express is minimalist, it’s also very flexible. This supports the
  <a href="https://blog.logrocket.com/express-middleware-a-complete-guide/"
    >development of various Express middlewares</a
  >
  that you can use to address almost any task or problem imaginable.
</p>
<h2 id="what-is-postgresql">What is PostgreSQL?</h2>
<p>
  PostgreSQL, commonly referred to as Postgres, is a free and open source
  relational database management system. You might be familiar with a few other
  similar database systems, like MySQL, Microsoft SQL Server, or MariaDB, which
  compete with PostgreSQL.
</p>
<p>
  PostgreSQL is a robust relational database that has been around since 1997.
  It’s available on all major operating systems — Linux, Windows, and macOS.
  Since PostgreSQL is known for stability, extensibility, and standards
  compliance, it’s a popular choice for developers and companies.
</p>
<p>
  It’s also possible to create a Node.js RESTful CRUD API using Sequelize.
  <a href="https://blog.logrocket.com/using-sequelize-with-typescript/"
    >Sequelize is a promise-based Node.js ORM</a
  >
  for Postgres, MySQL, MariaDB, SQLite, and Microsoft SQL Server.
</p>
<p>
  For more on how to use Sequelize in a Node.js REST API, check out the video
  tutorial below:
</p>
<p>
  <span class="embed-youtube" style="text-align: center; display: block"
    ><iframe
      class="youtube-player"
      width="640"
      height="360"
      src="https://www.youtube.com/embed/VDgXAw7VynQ?version=3&amp;rel=1&amp;showsearch=0&amp;showinfo=1&amp;iv_load_policy=1&amp;fs=1&amp;hl=en-US&amp;autohide=2&amp;wmode=transparent"
      allowfullscreen="true"
      style="border: 0"
      sandbox="allow-scripts allow-same-origin allow-popups allow-presentation allow-popups-to-escape-sandbox"
    ></iframe
  ></span>
</p>
<h2 id="what-is-node-postgres">What is node-postgres?</h2>
<p>
  <a href="https://www.npmjs.com/package/pg">node-postgres</a>, or pg, is a
  nonblocking PostgreSQL client for Node.js. Essentially, node-postgres is a
  collection of Node.js modules for interfacing with a PostgreSQL database.
</p>
<p>
  node-postgres supports many features, including callbacks, promises,
  async/await, connection pooling, prepared statements, cursors, rich type
  parsing, and C/C++ bindings.
</p>
<h2 id="creating-postgresql-database">Creating a PostgreSQL database</h2>
<p>
  We’ll begin this tutorial by installing PostgreSQL, creating a new user,
  creating a database, and initializing a table with a schema and some data.
</p>
<div class="code-block code-block-57" style="margin: 8px 0; clear: both">
  <hr />
  <div style="display: block; margin-bottom: 20px">
    <a href="https://lp.logrocket.com/blg/learn-more" class="embed-link">
      <div class="tweet-embed-container">
        <div class="single-tweet">
          <img
            src="https://blog.logrocket.com/wp-content/uploads/2023/07/Screen-Shot-2023-07-06-at-7.44.15-AM.png"
          />
        </div>
        <div class="embed-tweet-right">
          <h2>
            Over 200k developers use LogRocket to create better digital
            experiences
          </h2>
          <div class="embed-btn">
            <img
              src="https://blog.logrocket.com/wp-content/uploads/2022/08/rocket-button-icon.png"
            />Learn more →
          </div>
        </div>
      </div></a
    >
  </div>
  <hr />
  <style>
    @media all and (max-width: 800px) {
      .tweet-embed-container {
        flex-direction: column !important;
      }
      .single-tweet,
      .embed-tweet-right {
        width: 100% !important;
      }
    }
    .embed-link {
      text-decoration: none;
    }
    .embed-link:hover {
      text-decoration: none;
    }
    .tweet-embed-container {
      border-radius: 20px;
      background: radial-gradient(
          79.69% 102.24% at 100% 100.11%,
          rgba(0, 0, 0, 0.2),
          rgba(0, 0, 0, 0)
        ),
        radial-gradient(
          89.7% 115.09% at 3.43% 2.75%,
          rgba(255, 255, 255, 0.7),
          rgba(255, 255, 255, 0)
        ),
        #764abc;
      background-blend-mode: overlay, overlay, normal;
      box-shadow: 0 4px 0 #d5d5d5;
      width: auto;
      padding: 20px 15px;
      display: flex;
      flex-direction: row;
      justify-content: space-evenly;
      align-items: center;
      margin: 0 auto;
      gap: 3%;
    }
    .single-tweet {
      width: 50%;
    }
    .single-tweet img {
      max-width: 100%;
      height: auto;
      border-radius: 7px;
    }
    .embed-tweet-right {
      width: 46%;
    }
    .embed-tweet-right h2 {
      font-family: "Avenir";
      font-style: normal;
      font-weight: 500;
      font-size: 16px;
      line-height: 28px;
      color: #ffffff;
    }
    .embed-btn {
      display: flex;
      flex-direction: row;
      justify-content: left;
      width: 170px;
      gap: 5px;
      align-items: center;
      padding: 0px 10px;
      font-family: "Avenir";
      font-style: normal;
      font-weight: 900;
      font-size: 16px;
      line-height: 16px;
      color: #764abc;
      height: 48px;
      /* White */
      background: #ffffff;
      mix-blend-mode: normal;
      box-shadow: 0px 24px 30px rgba(0, 0, 0, 0.11);
      border-radius: 80px;
      border: none;
    }
  </style>
</div>
<h3>Installation</h3>
<p>
  If you’re using Windows, download a
  <a href="https://www.postgresql.org/download/windows/">Windows installer</a>
  of PostgreSQL.
</p>
<p>
  If you’re using a Mac, this tutorial assumes you have
  <a href="https://brew.sh/">Homebrew</a> installed on your computer as a
  package manager for installing new programs. If you don’t, simply click on the
  link and follow the instructions.
</p>
<p>
  Open up the terminal and install <code>postgresql</code> with
  <code>brew</code>:
</p>
<pre class="language-shell hljs">
brew install postgresql
</pre>
<p>
  You may see instructions on the web reading
  <code>brew install postgres</code> instead of <code>PostgreSQL</code>. Both
  options will install PostgreSQL on your computer.
</p>
<p>
  After the installation is complete, we’ll want to get
  <code>postgresql</code> up and running, which we can do with
  <code>services start</code>:
</p>
<pre class="language-shell hljs">
brew services start postgresql
==&gt; Successfully started `postgresql` (label: homebrew.mxcl.postgresql)
</pre>
<p>
  If at any point you want to stop the <code>postgresql</code> service, you can
  run <code>brew services stop postgresql</code>.
</p>
<p>
  With PostgreSQL installed, let’s next connect to the
  <code>postgres</code> command line where we can run SQL commands.
</p>
<h2 id="postgresql-command-prompt">PostgreSQL command prompt</h2>
<p>
  <code>psql</code> is the PostgreSQL interactive terminal. Running
  <code>psql</code> will connect you to a PostgreSQL host. Running
  <code>psql --help</code> will give you more information about the available
  options for connecting with <code>psql</code>:
</p>
<ul>
  <li>
    <code>-h</code> or <code>--host=HOSTNAME</code>: The database server host or
    socket directory; the default is <code>local socket</code>
  </li>
  <li>
    <code>-p</code> or <code>--port=PORT</code>: The database server port; the
    default is <code>5432</code>
  </li>
  <li>
    <code>-U</code> or <code>--username=USERNAME</code>: The database username;
    the default is <code>your_username</code>
  </li>
  <li>
    <code>-w</code> or <code>--no-password</code>: Never prompt for password
  </li>
  <li>
    <code>-W</code> or <code>--password</code>: Force password prompt, which
    should happen automatically
  </li>
</ul>
<p>
  We’ll connect to the default <code>postgres</code> database with the default
  login information and no option flags:
</p>
<pre class="language-sql hljs">
psql postgres
</pre>
<p>
  You’ll see that we’ve entered into a new connection. We’re now inside
  <code>psql</code> in the <code>postgres</code> database. The prompt ends with
  a <code>#</code> to denote that we’re logged in as the superuser, or root:
</p>
<pre class="language-sql hljs">
postgres=#
</pre>
<p>
  Commands within <code>psql</code> start with a backslash <code>\</code>. To
  test our first command, we can check what database, user, and port we’ve
  connected to using the <code>\conninfo</code> command:
</p>
<pre class="language-sql hljs">
postgres=# \conninfo
You are connected to database "postgres" as user "your_username" via socket in "/tmp" at port "5432".
</pre>
<p>
  The reference table below includes a few common commands that we’ll use
  throughout this tutorial:
</p>
<ul>
  <li><code>\q</code>: Exit <code>psql</code> connection</li>
  <li><code>\c</code>: Connect to a new database</li>
  <li><code>\dt</code>: List all tables</li>
  <li><code>\du</code>: List all roles</li>
  <li><code>\list</code>: List databases</li>
</ul>
<p>
  Let’s create a new database and user so we’re not using the default accounts,
  which have superuser privileges.
</p>
<h2 id="creating-role-postgres">Creating a role in Postgres</h2>
<p>
  First, we’ll create a role called <code>me</code> and give it a password of
  <code>password</code>. A role can function as a user or a group. In this case,
  we’ll use it as a user:
</p>
<pre class="language-sql hljs">
postgres=# CREATE ROLE me WITH LOGIN PASSWORD 'password';
</pre>
<p>We want <code>me</code> to be able to create a database:</p>
<pre class="language-sql hljs">
postgres=# ALTER ROLE me CREATEDB;
</pre>
<p>You can run <code>\du</code> to list all roles and users:</p>
<pre class="language-plaintext hljs">
me          | Create DB                           | {}
postgres    | Superuser, Create role, Create DB   | {}
</pre>
<p>
  Now, we want to create a database from the <code>me</code> user. Exit from the
  default session with <code>\q</code> for quit:
</p>
<pre class="language-sql hljs">
postgres=# \q
</pre>
<p>
  We’re back in our computer’s default terminal connection. Now, we’ll connect
  <code>postgres</code> with <code>me</code>:
</p>
<pre class="language-sql hljs">
psql -d postgres -U me
</pre>
<p>
  Instead of <code>postgres=#</code>, our prompt now shows
  <code>postgres=&gt;</code> , meaning we’re no longer logged in as a superuser.
</p>
<div class="code-block code-block-81" style="margin: 8px 0; clear: both">
  <iframe
    id="podrocket-plug"
    style="border-radius: 12px"
    src="https://open.spotify.com/embed/playlist/5hnQVGbOW4OByGmTOdNREp?utm_source=generator"
    width="100%"
    height="352"
    frameborder="0"
    allowfullscreen
    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
    loading="lazy"
  >
  </iframe>
  <style>
    #podrocket-plug {
      border-radius: 12px;
      width: 75%;
      height: 352px;
      margin: 1rem auto;
      display: block;
    }
  </style>
</div>
<h2 id="creating-database-postgres">Creating a database in Postgres</h2>
<p>We can create a database with the SQL command as follows:</p>
<pre class="language-sql hljs">
postgres=&gt; CREATE DATABASE api;
</pre>
<p>Use the <code>\list</code> command to see the available databases:</p>
<pre class="language-plaintext hljs">
Name    |    Owner    | Encoding |   Collate   |    Ctype    |
api     | me          | UTF8     | en_US.UTF-8 | en_US.UTF-8 |
</pre>
<p>
  Let’s connect to the new <code>api</code> database with <code>me</code> using
  the <code>\c</code> connect command:
</p>
<pre class="language-sql hljs">
postgres=&gt; \c api
You are now connected to database "api" as user "me".
api=&gt;
</pre>
<p>Our prompt now shows that we’re connected to <code>api</code>.</p>
<h2 id="creating-table-postgres">Creating a table in Postgres</h2>
<p>
  Finally, in the <code>psql</code> command prompt, we’ll create a table called
  <code>users</code> with three fields, two <code>VARCHAR</code> types, and an
  auto-incrementing <code>PRIMARY KEY</code> ID:
</p>
<pre class="language-sql hljs">
api=&gt;
CREATE TABLE users (
  ID SERIAL PRIMARY KEY,
  name VARCHAR(30),
  email VARCHAR(30)
);
</pre>
<p>
  Make sure not to use the backtick <code>`</code> character when creating and
  working with tables in PostgreSQL. While backticks are allowed in MySQL,
  they’re not valid in PostgreSQL. Also, ensure that you do not have a trailing
  comma in the CREATE TABLE command.
</p>
<div class="code-block code-block-54" style="margin: 8px 0; clear: both">
  <hr />
  <h3>More great articles from LogRocket:</h3>
  <ul>
    <li>
      Don't miss a moment with
      <a href="https://lp.logrocket.com/subscribe-thereplay">The Replay</a>, a
      curated newsletter from LogRocket
    </li>
    <li>
      <a
        href="https://blog.logrocket.com/rethinking-error-tracking-product-analytics/"
        >Learn</a
      >
      how LogRocket's Galileo cuts through the noise to proactively resolve
      issues in your app
    </li>
    <li>
      Use React's useEffect
      <a
        href="https://blog.logrocket.com/understanding-react-useeffect-cleanup-function/"
        >to optimize your application's performance</a
      >
    </li>
    <li>
      Switch between
      <a
        href="https://blog.logrocket.com/switching-between-node-versions-during-development/"
        >multiple versions of Node</a
      >
    </li>
    <li>
      <a
        href="https://blog.logrocket.com/using-react-children-prop-with-typescript/"
        >Discover
      </a>
      how to use the React children prop with TypeScript
    </li>
    <li>
      <a href="https://blog.logrocket.com/creating-custom-mouse-cursor-css/"
        >Explore</a
      >
      creating a custom mouse cursor with CSS
    </li>
    <li>
      Advisory boards aren’t just for executives.
      <a href="https://lp.logrocket.com/blg/content-advisory-board-signup"
        >Join LogRocket’s Content Advisory Board.</a
      >
      You’ll help inform the type of content we create and get access to
      exclusive meetups, social accreditation, and swag.
    </li>
  </ul>
  <hr />
</div>
<p>
  Let’s add some data to work with by adding two entries to <code>users</code>:
</p>
<pre class="language-sql hljs">INSERT INTO users (name, email)
  VALUES ('Jerry', '<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="33595641414a73564b525e435f561d505c5e">[email&#160;protected]</a>'), ('George', '<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9ef9fbf1ecf9fbdefbe6fff3eef2fbb0fdf1f3">[email&#160;protected]</a>');
</pre>
<p>
  Let’s make sure that the information above was correctly added by getting all
  entries in <code>users</code>:
</p>
<pre class="language-sql hljs">api=&gt; SELECT * FROM users;
id |  name  |       email        
----+--------+--------------------
  1 | Jerry  | <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c4aea1b6b6bd84a1bca5a9b4a8a1eaa7aba9">[email&#160;protected]</a>
  2 | George | <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ccaba9a3beaba98ca9b4ada1bca0a9e2afa3a1">[email&#160;protected]</a>
</pre>
<p>
  Now, we have a user, database, table, and some data. We can begin building our
  Node.js RESTful API to connect to this data, stored in a PostgreSQL database.
</p>
<p>
  At this point, we’re finished with all of our PostgreSQL tasks, and we can
  begin setting up our Node.js app and Express server.
</p>
<h2 id="setting-up-express-server">Setting up an Express server</h2>
<p>
  To set up a Node.js app and Express server, first create a directory for the
  project to live in:
</p>
<pre class="language-shell hljs">
mkdir node-api-postgres
cd node-api-postgres
</pre>
<p>
  You can either run <code>npm init -y</code> to create a
  <code>package.json</code> file, or copy the code below into a
  <code>package.json</code> file:
</p>
<pre class="language-json hljs">
{
  "name": "node-api-postgres",
  "version": "1.0.0",
  "description": "RESTful API with Node.js, Express, and PostgreSQL",
  "main": "index.js",
  "license": "MIT"
}
</pre>
<p>
  We’ll want to install Express for the server and node-postgres to connect to
  PostgreSQL:
</p>
<pre class="language-bash hljs">
npm i express pg
</pre>
<p>
  Now, we have our dependencies loaded into <code>node_modules</code> and
  <code>package.json</code>.
</p>
<p>
  Create an <code>index.js</code> file, which we’ll use as the entry point for
  our server. At the top, we’ll require the <code>express</code> module, the
  built-in
  <a href="http://expressjs.com/en/resources/middleware/body-parser.html"
    ><code>body-parser</code> middleware</a
  >, and we’ll set our <code>app</code> and <code>port</code> variables:
</p>
<pre class="language-javascript hljs">
const express = require('express')
const bodyParser = require('body-parser')
const app = express()
const port = 3000

app.use(bodyParser.json())
app.use(
  bodyParser.urlencoded({
    extended: true,
  })
)
</pre>
<p>
  We’ll tell a route to look for a <code>GET</code> request on the root
  <code>/</code> URL and return some JSON:
</p>
<pre class="language-json hljs">
app.get('/', (request, response) =&gt; {
  response.json({ info: 'Node.js, Express, and Postgres API' })
})
</pre>
<p>Now, set the app to listen on the port you set:</p>
<pre class="language-javascript hljs">
app.listen(port, () =&gt; {
  console.log(`App running on port ${port}.`)
})
</pre>
<p>
  From the command line, we can start the server by hitting
  <code>index.js</code>:
</p>
<pre class="language-javascript hljs">
node index.js
App running on port 3000.
</pre>
<p>
  Go to <code>http://localhost:3000</code> in the URL bar of your browser, and
  you’ll see the JSON we set earlier:
</p>
<pre class="language-json hljs">
{
  info: "Node.js, Express, and Postgres API"
}
</pre>
<p>
  The Express server is running now, but it’s only sending some static JSON data
  that we created. The next step is to connect to PostgreSQL from Node.js to be
  able to make dynamic queries.
</p>
<h2 id="connecting-postgres-database-client">
  Connecting to a Postgres database using a Client
</h2>
<p>
  A popular client for accessing Postgres databases is the
  <a href="https://www.pgadmin.org/">pgAdmin</a> client. The pgAdmin application
  is available for various platforms. If you want to have a graphical user
  interface for your Postgres databases, you can go to the
  <a href="https://www.pgadmin.org/download/">download page</a> and download the
  necessary package.
</p>
<p>
  Creating and querying your database using pgAdmin is simple. You need to click
  on the <strong>Object</strong> option available on the top menu, select
  <strong>Create</strong>, and choose <strong>Database</strong> to create a new
  connection. All the databases are available on the side menu. You can query or
  run SQL queries efficiently by selecting the proper database:
</p>
<p>
  <img
    loading="lazy"
    decoding="async"
    data-attachment-id="185861"
    data-permalink="https://blog.logrocket.com/crud-rest-api-node-js-express-postgresql/attachment/create-query-database/"
    data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Create-query-database.png"
    data-orig-size="895,479"
    data-comments-opened="1"
    data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}'
    data-image-title="Create-query-database"
    data-image-description
    data-image-caption
    data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Create-query-database.png?w=300"
    data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Create-query-database.png?w=895"
    class="aligncenter size-full wp-image-185861"
    src="https://blog.logrocket.com/wp-content/uploads/2022/05/Create-query-database.png"
    alt="Screenshot Of Process Using Pgadmin To Create A Query Database"
    width="895"
    height="479"
    srcset="
      https://blog.logrocket.com/wp-content/uploads/2022/05/Create-query-database.png                895w,
      https://blog.logrocket.com/wp-content/uploads/2022/05/Create-query-database.png?resize=300,161 300w,
      https://blog.logrocket.com/wp-content/uploads/2022/05/Create-query-database.png?resize=768,411 768w
    "
    sizes="(max-width: 895px) 100vw, 895px"
  />
</p>
<h2 id="connecting-postgres-database-node-js">
  Connecting to a Postgres database from Node.js
</h2>
<p>
  We’ll use the <a href="https://node-postgres.com/">node-postgres</a> module to
  create a pool of connections. Therefore, we don’t have to open and close a
  client each time we make a query.
</p>
<p>
  A popular option for production pooling would be to use
  <code>[pgBouncer](https://pgbouncer.github.io/)</code>, a lightweight
  connection pooler for PostgreSQL.
</p>
<pre class="language-javascript hljs">
const Pool = require('pg').Pool
const pool = new Pool({
  user: 'me',
  host: 'localhost',
  database: 'api',
  password: 'password',
  port: 5432,
})
</pre>
<p>
  In a production environment, you would want to put your configuration details
  in a separate file with restrictive permissions so that it is not accessible
  from version control. But, for the simplicity of this tutorial, we’ll keep it
  in the same file as the queries.
</p>
<p>
  The aim of this tutorial is to allow CRUD operations — <code>GET</code>,
  <code>POST</code>, <code>PUT</code>, and <code>DELETE</code> — on the API,
  which will run the corresponding database commands. To do so, we’ll set up a
  route for each endpoint and a function corresponding to each query.
</p>
<h2 id="creating-routes-crud-operations">
  Creating routes for CRUD operations
</h2>
<p>
  We’ll create six functions for six routes, as shown below. First, create all
  the functions for each route. Then, export the functions so they’re
  accessible:
</p>
<ul>
  <li><code>GET</code>: <code>/</code> | <code>displayHome()</code></li>
  <li><code>GET</code>: <code>/users</code> | <code>getUsers()</code></li>
  <li>
    <code>GET</code>: <code>/users/:id</code> | <code>getUserById()</code>
  </li>
  <li><code>POST</code>: <code>/users</code> | <code>createUser()</code></li>
  <li><code>PUT</code>: <code>/users/:id</code> | <code>updateUser()</code></li>
  <li>
    <code>DELETE</code>: <code>/users/:id</code> | <code>deleteUser()</code>
  </li>
</ul>
<p>
  In <code>index.js</code>, we made an <code>app.get()</code> for the root
  endpoint with a function in it. Now, in <code>queries.js</code>, we’ll create
  endpoints that will display all users, display a single user, create a new
  user, update an existing user, and delete a user.
</p>
<h3><code>GET</code> all users</h3>
<p>
  Our first endpoint will be a <code>GET</code> request. We can put the raw SQL
  that will touch the <code>api</code> database inside the
  <code>pool.query()</code>. We’ll <code>SELECT</code> all users and order by
  ID.
</p>
<pre class="language-javascript hljs">
const getUsers = (request, response) =&gt; {
  pool.query('SELECT * FROM users ORDER BY id ASC', (error, results) =&gt; {
    if (error) {
      throw error
    }
    response.status(200).json(results.rows)
  })
}
</pre>
<h3><code>GET</code> a single user by ID</h3>
<p>
  For our <code>/users/:id</code> request, we’ll get the custom
  <code>id</code> parameter by the URL and use a <code>WHERE</code> clause to
  display the result.
</p>
<p>
  In the SQL query, we’re looking for <code>id=$1</code>. In this instance,
  <code>$1</code> is a numbered placeholder that PostgreSQL uses natively
  instead of the <code>?</code> placeholder that you may recognize from other
  variations of SQL:
</p>
<pre class="language-javascript hljs">
const getUserById = (request, response) =&gt; {
  const id = parseInt(request.params.id)

  pool.query('SELECT * FROM users WHERE id = $1', [id], (error, results) =&gt; {
    if (error) {
      throw error
    }
    response.status(200).json(results.rows)
  })
}
</pre>
<h3><code>POST</code> a new user</h3>
<p>
  The API will take a <code>GET</code> and <code>POST</code> request to the
  <code>/users</code> endpoint. In the <code>POST</code> request, we’ll add a
  new user. In this function, we’re extracting the <code>name</code> and
  <code>email</code> properties from the request body and inserting the values
  with <code>INSERT</code>:
</p>
<pre class="language-javascript hljs">
const createUser = (request, response) =&gt; {
  const { name, email } = request.body

  pool.query('INSERT INTO users (name, email) VALUES ($1, $2) RETURNING *', [name, email], (error, results) =&gt; {
    if (error) {
      throw error
    }
    response.status(201).send(`User added with ID: ${results.rows[0].id}`)
  })
}
</pre>
<h3><code>PUT</code> updated data in an existing user</h3>
<p>
  The <code>/users/:id</code> endpoint will also take two HTTP requests, the
  <code>GET</code> we created for <code>getUserById</code> and a
  <code>PUT</code> to modify an existing user. For this query, we’ll combine
  what we learned in <code>GET</code> and <code>POST</code> to use the
  <code>UPDATE</code> clause.
</p>
<p>
  It’s worth noting that <code>PUT</code> is idempotent, meaning the exact same
  call can be made over and over and will produce the same result.
  <code>PUT</code> is different than <code>POST</code>, in which the exact same
  call repeated will continuously make new users with the same data:
</p>
<pre class="language-javascript hljs">
const updateUser = (request, response) =&gt; {
  const id = parseInt(request.params.id)
  const { name, email } = request.body

  pool.query(
    'UPDATE users SET name = $1, email = $2 WHERE id = $3',
    [name, email, id],
    (error, results) =&gt; {
      if (error) {
        throw error
      }
      response.status(200).send(`User modified with ID: ${id}`)
    }
  )
}
</pre>
<h3><code>DELETE</code> a user</h3>
<p>
  Finally, we’ll use the <code>DELETE</code> clause on
  <code>/users/:id</code> to delete a specific user by ID. This call is very
  similar to our <code>getUserById()</code> function:
</p>
<pre class="language-javascript hljs">
const deleteUser = (request, response) =&gt; {
  const id = parseInt(request.params.id)

  pool.query('DELETE FROM users WHERE id = $1', [id], (error, results) =&gt; {
    if (error) {
      throw error
    }
    response.status(200).send(`User deleted with ID: ${id}`)
  })
}
</pre>
<h2 id="exporting-crud-functions-rest-api">
  Exporting CRUD functions in a REST API
</h2>
<p>
  To access these functions from <code>index.js</code>, we’ll need to export
  them. We can do so with <code>module.exports</code>, creating an object of
  functions. Since we’re using the ES6 syntax, we can write
  <code>getUsers</code> instead of <code>getUsers:getUsers</code> and so on:
</p>
<pre class="language-javascript hljs">
module.exports = {
  getUsers,
  getUserById,
  createUser,
  updateUser,
  deleteUser,
}
</pre>
<p>Our complete <code>queries.js</code> file is below:</p>
<pre class="language-javascript hljs">
const Pool = require('pg').Pool
const pool = new Pool({
  user: 'me',
  host: 'localhost',
  database: 'api',
  password: 'password',
  port: 5432,
})
const getUsers = (request, response) =&gt; {
  pool.query('SELECT * FROM users ORDER BY id ASC', (error, results) =&gt; {
    if (error) {
      throw error
    }
    response.status(200).json(results.rows)
  })
}

const getUserById = (request, response) =&gt; {
  const id = parseInt(request.params.id)

  pool.query('SELECT * FROM users WHERE id = $1', [id], (error, results) =&gt; {
    if (error) {
      throw error
    }
    response.status(200).json(results.rows)
  })
}

const createUser = (request, response) =&gt; {
  const { name, email } = request.body

  pool.query('INSERT INTO users (name, email) VALUES ($1, $2)', [name, email], (error, results) =&gt; {
    if (error) {
      throw error
    }
    response.status(201).send(`User added with ID: ${results.insertId}`)
  })
}

const updateUser = (request, response) =&gt; {
  const id = parseInt(request.params.id)
  const { name, email } = request.body

  pool.query(
    'UPDATE users SET name = $1, email = $2 WHERE id = $3',
    [name, email, id],
    (error, results) =&gt; {
      if (error) {
        throw error
      }
      response.status(200).send(`User modified with ID: ${id}`)
    }
  )
}

const deleteUser = (request, response) =&gt; {
  const id = parseInt(request.params.id)

  pool.query('DELETE FROM users WHERE id = $1', [id], (error, results) =&gt; {
    if (error) {
      throw error
    }
    response.status(200).send(`User deleted with ID: ${id}`)
  })
}

module.exports = {
  getUsers,
  getUserById,
  createUser,
  updateUser,
  deleteUser,
}
</pre>
<h2 id="setting-up-crud-functions-rest-api">
  Setting up CRUD functions in a REST API
</h2>
<p>
  Now that we have all of our queries, we need to pull them into the
  <code>index.js</code> file and make endpoint routes for all the query
  functions we created.
</p>
<p>
  To get all the exported functions from <code>queries.js</code>, we’ll
  <code>require</code> the file and assign it to a variable:
</p>
<pre class="language-javascript hljs">
const db = require('./queries')
</pre>
<p>
  Now, for each endpoint, we’ll set the HTTP request method, the endpoint URL
  path, and the relevant function:
</p>
<pre class="language-javascript hljs">
app.get('/users', db.getUsers)
app.get('/users/:id', db.getUserById)
app.post('/users', db.createUser)
app.put('/users/:id', db.updateUser)
app.delete('/users/:id', db.deleteUser)
</pre>
<p>
  Below is our complete <code>index.js</code> file, the entry point of the API
  server:
</p>
<pre class="language-javascript hljs">
const express = require('express')
const bodyParser = require('body-parser')
const app = express()
const db = require('./queries')
const port = 3000

app.use(bodyParser.json())
app.use(
  bodyParser.urlencoded({
    extended: true,
  })
)

app.get('/', (request, response) =&gt; {
  response.json({ info: 'Node.js, Express, and Postgres API' })
})

app.get('/users', db.getUsers)
app.get('/users/:id', db.getUserById)
app.post('/users', db.createUser)
app.put('/users/:id', db.updateUser)
app.delete('/users/:id', db.deleteUser)

app.listen(port, () =&gt; {
  console.log(`App running on port ${port}.`)
})
</pre>
<p>
  With just these two files, we have a server, database, and our API all set up.
  You can start up the server by hitting <code>index.js</code> again:
</p>
<pre class="language-javascript hljs">
node index.js
App running on port 3000.
</pre>
<p>
  Now, if you go to <code>http://localhost:3000/users</code> or
  <code>http://localhost:3000/users/1</code>, you’ll see the JSON response of
  the two <code>GET</code> requests.
</p>
<p>
  To test our <code>POST</code>, <code>PUT</code>, and
  <code>DELETE</code> requests, we can use a tool like Postman or a VS Code
  extension like <a href="https://www.thunderclient.com/">Thunder Client</a> to
  send the HTTP requests. You can also use
  <a
    href="https://blog.logrocket.com/an-intro-to-curl-the-basics-of-the-transfer-tool/"
    >curl, a command-line tool</a
  >
  that is already available on your terminal.
</p>
<p>
  Using a tool like Postman or Thunder Client makes it simple to query endpoints
  with different HTTP methods. Simply enter your URL, choose the specific HTTP
  method, insert the JSON value if the endpoint is a PUT or POST route, and hit
  <strong>Send</strong>:
</p>
<p>
  <img
    loading="lazy"
    decoding="async"
    data-attachment-id="185862"
    data-permalink="https://blog.logrocket.com/crud-rest-api-node-js-express-postgresql/attachment/add-new-user-thunder-client-vs-code/"
    data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Add-new-user-Thunder-Client-VS-Code.png"
    data-orig-size="895,440"
    data-comments-opened="1"
    data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}'
    data-image-title="Add-new-user-Thunder-Client-VS-Code"
    data-image-description
    data-image-caption
    data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Add-new-user-Thunder-Client-VS-Code.png?w=300"
    data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Add-new-user-Thunder-Client-VS-Code.png?w=895"
    class="aligncenter size-full wp-image-185862"
    src="https://blog.logrocket.com/wp-content/uploads/2022/05/Add-new-user-Thunder-Client-VS-Code.png"
    alt="Example Of How To Add A New User With Thunder Client And Vs Code"
    width="895"
    height="440"
    srcset="
      https://blog.logrocket.com/wp-content/uploads/2022/05/Add-new-user-Thunder-Client-VS-Code.png                895w,
      https://blog.logrocket.com/wp-content/uploads/2022/05/Add-new-user-Thunder-Client-VS-Code.png?resize=300,147 300w,
      https://blog.logrocket.com/wp-content/uploads/2022/05/Add-new-user-Thunder-Client-VS-Code.png?resize=768,378 768w
    "
    sizes="(max-width: 895px) 100vw, 895px"
  />
</p>
<p>
  The example above shows sending a <code>POST</code> request to the specified
  route. The <code>POST</code> option suggests that it is a
  <code>POST</code> request. The URL beside the method is the API endpoint, and
  the JSON content is the data to be sent to the endpoint. You can hit the
  different routes similarly.
</p>
<p>
  Here’s an example of sending a <code>POST</code> request to the specified
  route to create a new user using Postman:
</p>
<p>
  <img
    loading="lazy"
    decoding="async"
    data-attachment-id="185863"
    data-permalink="https://blog.logrocket.com/crud-rest-api-node-js-express-postgresql/attachment/add-new-user-postman/"
    data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Add-new-user-Postman.png"
    data-orig-size="895,559"
    data-comments-opened="1"
    data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}'
    data-image-title="Add-new-user-Postman"
    data-image-description
    data-image-caption
    data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Add-new-user-Postman.png?w=300"
    data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Add-new-user-Postman.png?w=895"
    class="aligncenter size-full wp-image-185863"
    src="https://blog.logrocket.com/wp-content/uploads/2022/05/Add-new-user-Postman.png"
    alt="Example Of How To Add A New User Using Postman"
    width="895"
    height="559"
    srcset="
      https://blog.logrocket.com/wp-content/uploads/2022/05/Add-new-user-Postman.png                895w,
      https://blog.logrocket.com/wp-content/uploads/2022/05/Add-new-user-Postman.png?resize=300,187 300w,
      https://blog.logrocket.com/wp-content/uploads/2022/05/Add-new-user-Postman.png?resize=768,480 768w
    "
    sizes="(max-width: 895px) 100vw, 895px"
  />
</p>
<p>
  Here’s an example of sending a <code>PUT</code> request to the specified route
  to modify a user by its ID:
</p>
<p>
  <img
    loading="lazy"
    decoding="async"
    data-attachment-id="185857"
    data-permalink="https://blog.logrocket.com/crud-rest-api-node-js-express-postgresql/attachment/update-user-by-id-postman/"
    data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Update-user-by-ID-Postman.png"
    data-orig-size="895,559"
    data-comments-opened="1"
    data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}'
    data-image-title="Update-user-by-ID-Postman"
    data-image-description
    data-image-caption
    data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Update-user-by-ID-Postman.png?w=300"
    data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Update-user-by-ID-Postman.png?w=895"
    class="aligncenter size-full wp-image-185857"
    src="https://blog.logrocket.com/wp-content/uploads/2022/05/Update-user-by-ID-Postman.png"
    alt="Example Of How To Update User By Id Using Postman"
    width="895"
    height="559"
    srcset="
      https://blog.logrocket.com/wp-content/uploads/2022/05/Update-user-by-ID-Postman.png                895w,
      https://blog.logrocket.com/wp-content/uploads/2022/05/Update-user-by-ID-Postman.png?resize=300,187 300w,
      https://blog.logrocket.com/wp-content/uploads/2022/05/Update-user-by-ID-Postman.png?resize=768,480 768w
    "
    sizes="(max-width: 895px) 100vw, 895px"
  />
</p>
<p>
  Here’s an example of sending a <code>GET</code> request to the specified route
  to retrieve a user by its ID:
</p>
<p>
  <img
    loading="lazy"
    decoding="async"
    data-attachment-id="185858"
    data-permalink="https://blog.logrocket.com/crud-rest-api-node-js-express-postgresql/attachment/read-user-by-id-postman/"
    data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Read-user-by-ID-Postman.png"
    data-orig-size="895,559"
    data-comments-opened="1"
    data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}'
    data-image-title="Read-user-by-ID-Postman"
    data-image-description
    data-image-caption
    data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Read-user-by-ID-Postman.png?w=300"
    data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Read-user-by-ID-Postman.png?w=895"
    class="aligncenter size-full wp-image-185858"
    src="https://blog.logrocket.com/wp-content/uploads/2022/05/Read-user-by-ID-Postman.png"
    alt="Example Of How To Read User By Id Using Postman"
    width="895"
    height="559"
    srcset="
      https://blog.logrocket.com/wp-content/uploads/2022/05/Read-user-by-ID-Postman.png                895w,
      https://blog.logrocket.com/wp-content/uploads/2022/05/Read-user-by-ID-Postman.png?resize=300,187 300w,
      https://blog.logrocket.com/wp-content/uploads/2022/05/Read-user-by-ID-Postman.png?resize=768,480 768w
    "
    sizes="(max-width: 895px) 100vw, 895px"
  />
</p>
<p>
  Here’s an example of sending a <code>GET</code> request to the specified route
  to retrieve all users:
</p>
<p>
  <img
    loading="lazy"
    decoding="async"
    data-attachment-id="185859"
    data-permalink="https://blog.logrocket.com/crud-rest-api-node-js-express-postgresql/attachment/fetch-all-users-postman/"
    data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Fetch-all-users-Postman.png"
    data-orig-size="895,559"
    data-comments-opened="1"
    data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}'
    data-image-title="Fetch-all-users-Postman"
    data-image-description
    data-image-caption
    data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Fetch-all-users-Postman.png?w=300"
    data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Fetch-all-users-Postman.png?w=895"
    class="aligncenter size-full wp-image-185859"
    src="https://blog.logrocket.com/wp-content/uploads/2022/05/Fetch-all-users-Postman.png"
    alt="Example Of How To Fetch All Users By Id Using Postman"
    width="895"
    height="559"
    srcset="
      https://blog.logrocket.com/wp-content/uploads/2022/05/Fetch-all-users-Postman.png                895w,
      https://blog.logrocket.com/wp-content/uploads/2022/05/Fetch-all-users-Postman.png?resize=300,187 300w,
      https://blog.logrocket.com/wp-content/uploads/2022/05/Fetch-all-users-Postman.png?resize=768,480 768w
    "
    sizes="(max-width: 895px) 100vw, 895px"
  />
</p>
<p>
  Finally, here’s an example of sending a <code>DELETE</code> request to the
  specified route to delete a user by its ID:
</p>
<p>
  <img
    loading="lazy"
    decoding="async"
    data-attachment-id="185860"
    data-permalink="https://blog.logrocket.com/crud-rest-api-node-js-express-postgresql/attachment/delete-user-postman/"
    data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Delete-user-Postman.png"
    data-orig-size="895,559"
    data-comments-opened="1"
    data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}'
    data-image-title="Delete-user-Postman"
    data-image-description
    data-image-caption
    data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Delete-user-Postman.png?w=300"
    data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/05/Delete-user-Postman.png?w=895"
    class="aligncenter size-full wp-image-185860"
    src="https://blog.logrocket.com/wp-content/uploads/2022/05/Delete-user-Postman.png"
    alt="Example Of How To Delete Users By Id Using Postman"
    width="895"
    height="559"
    srcset="
      https://blog.logrocket.com/wp-content/uploads/2022/05/Delete-user-Postman.png                895w,
      https://blog.logrocket.com/wp-content/uploads/2022/05/Delete-user-Postman.png?resize=300,187 300w,
      https://blog.logrocket.com/wp-content/uploads/2022/05/Delete-user-Postman.png?resize=768,480 768w
    "
    sizes="(max-width: 895px) 100vw, 895px"
  />
</p>
<h2 id="solutions-common-issues-encountered-developing-apis">
  Solutions to common issues encountered while developing APIs
</h2>
<p>
  Developing APIs can come with various challenges. Let’s go over the solutions
  to two common issues encountered during API development: CORS issues and
  unhandled errors due to middleware order.
</p>
<h3>Handling CORS issues</h3>
<p>
  Browser security policies can block requests from different origins. To
  address this issue, use the <code>cors</code> middleware in Express to handle
  cross-origin resource sharing (CORS).
</p>
<p>Run the following command to install <code>cors</code>:</p>
<pre class="language-bash hljs">
npm install cors
</pre>
<p>To use it, do the following:</p>
<pre class="language-javascript hljs">
var express = require('express')
var cors = require('cors')
var app = express()

app.use(cors())
</pre>
<p>This will enable CORS for all origins.</p>
<h3>Middleware order and error handling</h3>
<p>
  Middleware order can affect error handling, leading to unhandled errors. To
  address this issue, place error-handling middleware at the end of your
  middleware stack and use <code>next(err)</code> to pass errors to the
  error-handling middleware:
</p>
<pre class="language-javascript hljs">
app.use((req, res, next) =&gt; {
    const error = new Error('Something went wrong');
    next(error);
});
// Error-handling Middleware
app.use((err, req, res, next) =&gt; {
    console.error('Error:', err.message);
    res.status(500).send('Internal Server Error');
});
</pre>
<h2 id="securing-api">Securing the API</h2>
<p>
  When it comes to securing APIs, we need to implement various mechanisms to
  ensure the confidentiality, and integrity of the application and its data.
  Let’s go over a few of these mechanisms now.
</p>
<h3>Authentication</h3>
<p>
  You can implement strong authentication mechanisms, such as JSON Web Tokens
  (JWT) or OAuth, to verify the identity of clients. Ensure that only
  authenticated and authorized users can access certain routes — in our case,
  the <code>POST</code>, <code>PUT</code>, and <code>DELETE</code> methods.
</p>
<p>
  I will recommend
  <a href="https://blog.logrocket.com/using-passport-authentication-node-js/"
    >the Passport middleware for Node.js</a
  >, which makes it easy to implement authentication and authorization. Here’s
  an example of how to use Passport:
</p>
<pre class="language-javascript hljs">
const passport = require('passport');
const LocalStrategy = require('passport-local').Strategy;

passport.use(new LocalStrategy(
    function(username, password, done) {
        // Verify username and password
        // Call done(null, user) if authentication is successful
    }
));
</pre>
<h3>Authorization</h3>
<p>
  It’s important to enforce proper access controls to restrict access to
  specific routes or resources based on the user’s role or permissions. For
  example, you can check if the user making a request has
  <code>admin</code> privileges before allowing or denying them permission to
  proceed with the request:
</p>
<pre class="language-javascript hljs">
function isAdmin(req, res, next) {
    if (req.user &amp;&amp; req.user.role === 'admin') {
        return next();
    } else {
        return res.status(403).json({ message: 'Permission denied' });
    }
}
</pre>
<p>
  You can apply the <code>isAdmin</code> middleware defined above to any
  protected routes, thus restricting access to those routes.
</p>
<h3>Input validation</h3>
<p>
  Validate and sanitize user inputs to prevent SQL injection, XSS, and other
  security vulnerabilities. For example:
</p>
<pre class="language-javascript hljs">
const { body, validationResult } = require('express-validator');

app.post('/users', [
    // add validation rules
], (req, res) =&gt; {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
        return res.status(422).json({ errors: errors.array() });
    }
    // Process the request
});
</pre>
<p>
  The code above allows you to specify validation rules for POST requests to the
  <code>/users</code> endpoint. If the validation fails, it sends a response
  with the validation errors. If the incoming data is correct and safe, it
  proceeds with processing the request.
</p>
<h3>Helmet middleware</h3>
<p>
  You can use
  <a href="https://blog.logrocket.com/using-helmet-node-js-secure-application/"
    >the Helmet middleware</a
  >
  to set various HTTP headers for enhanced security:
</p>
<pre class="language-javascript hljs">
const helmet = require('helmet');
app.use(helmet());
</pre>
<p>
  Configuring HTTP headers with Helmet helps protect your app from security
  issues like XSS attacks, CSP vulnerabilities, and more.
</p>
<h2 id="additional-notes-suggestions">Additional notes and suggestions</h2>
<p>You can build on this tutorial by implementing the following suggestions:</p>
<ul>
  <li style="padding-bottom: 10px">
    <strong>Integration with frontend frameworks</strong>: Choose a frontend
    framework or library (e.g., React, Angular, Vue.js) to build a user
    interface for your application. Then, implement API calls from the frontend
    to interact with the backend CRUD operations. You can consider state
    management solutions (e.g., Redux, Vuex) for managing the state of your
    frontend application
  </li>
  <li style="padding-bottom: 10px">
    <strong>Containerizing the API</strong>: Write a Dockerfile to define the
    environment and dependencies needed to run your Node.js app. Create a
    <code>docker-compose.yml</code> file for managing multiple containers, such
    as the Node.js app and PostgreSQL database. This will make your Node.js
    application easier to deploy and set up on other machines
  </li>
  <li style="padding-bottom: 10px">
    <strong>Implementing unit/integration tests:</strong> Write unit tests for
    individual functions and components of your application to ensure that they
    work as expected. Use testing frameworks like Mocha, Jest, or Jasmine for
    writing and running tests. Implement integration tests to verify the
    interactions between different components in your front-end application and
    the overall functionality of your API
  </li>
  <li>
    <strong>Continuous integration/deployment (CI/CD)</strong>: Set up CI/CD
    pipelines to automate the testing and deployment processes. Use tools like
    Jenkins, Travis CI, or GitHub Actions to streamline the
    development/deployment workflow
  </li>
</ul>
<p>
  While actually implementing these next steps is beyond the scope of this
  tutorial, you can use these ideas to apply what we’ve discussed to a real use
  case.
</p>
<h2>Conclusion</h2>
<p>
  You should now have a functioning API server that runs on Node.js and is
  hooked up to an active PostgreSQL database.
</p>
<p>
  In this tutorial, we learned how to install and set up PostgreSQL in the
  command line, create users, databases, and tables, and run SQL commands. We
  also learned how to create an Express server that can handle multiple HTTP
  methods and use the <code>pg</code> module to connect to PostgreSQL from
  Node.js.
</p>
<p>
  With this knowledge, you should be able to build on this API and utilize it
  for your own personal or professional development projects.
</p>

        </article>
    </main>
</body>

</html>
